# Replace 'odoo.yourdomain.com' with your actual domain name
odoo.yourdomain.com {
    # Enable compression
    encode gzip zstd

    # Handle longpolling requests
    @longpolling {
        path /longpolling/*
    }
    reverse_proxy @longpolling odoo:8072 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # Handle all other requests
    reverse_proxy odoo:8069 {
        # Enable buffering for better performance
        flush_interval -1
        
        # Set common headers
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
        
        # WebSocket support
        header_up Connection {>Connection}
        header_up Upgrade {>Upgrade}
    }

    # Security headers
    header {
        # Enable HSTS
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        # Prevent clickjacking
        X-Frame-Options "SAMEORIGIN"
        # XSS protection
        X-Content-Type-Options "nosniff"
        # Remove server information
        -Server
    }

    # Log access
    log {
        output file /data/access.log {
            roll_size 100mb
            roll_keep 5
            roll_keep_for 720h
        }
        format json
    }
}

